<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.135.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Kubernetes on ARM&nbsp;&ndash;&nbsp;$> cat /var/log/e770r</title><link rel=stylesheet href=/css/core.min.63f706677e61b4ee62b8daf083358d3bbf8ac8ab03c7d171af3180fab3a3ebb83efb79fb98674f13dde6db11de2bf694.css integrity=sha384-Y/cGZ35htO5iuNrwgzWNO7+KyKsDx9FxrzGA+rOj67g++3n7mGdPE93m2xHeK/aU><meta name=twitter:card content="summary">
<meta name=twitter:title content="Kubernetes on ARM"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src="https://avatars.githubusercontent.com/u/53065463?v=4" alt><span class="site name">$> cat /var/log/e770r</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>Categories</a><a class="nav item" href=/tags/>Tags</a></nav></div></span></div><div class="site slogan"><span class=title>logging my experiences one blog at a time ~</span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Kubernetes on ARM</h1><p class="article date">2022-08-21</p></section><article class="article markdown-body"><h1 id=kubernetes-on-arm>Kubernetes on ARM</h1><p>It‚Äôs a nice Tuesday morning, the sun is out and I have had my first cup of coffee, what a lovely time to attempt to install Kubernetes on my Raspberry Pi.</p><p>I‚Äôm using the Raspberry Pi 4 with a 128GB SD card running <a href=https://www.raspbian.org/ target=_blank rel="noopener noreferrer">Raspbian</a>. Would this be enough? No idea but I‚Äôm about to find out.</p><p><img src=https://file.coffee/u/zgvZ35YWTfDlHxtAc8ZlP.gif alt=lets-go-the-rock.gif></p><h2 id=current-setup>Current Setup</h2><p>So far the only configuration I have made is assigning a static IP address and connected the PI to my router over Ethernet.</p><p><img src=https://file.coffee/u/rOjz_pfKQGiLuptFH4B4g.jpg alt="current setup "></p><p>current setup</p><h2 id=kubernetes-distributions>Kubernetes Distributions</h2><p>Much Like Ice-Cream Kubernetes comes in different flavors picking the right combination would be key to how well this works ( so I think). Here are a few I evaluated.</p><h3 id=kindhttpskindsigsk8sio-kubernetes-in-docker><a href=https://kind.sigs.k8s.io/ target=_blank rel="noopener noreferrer">KinD</a> (Kubernetes in Docker)</h3><p>KinD is a tool for running Kubernetes in Docker, it‚Äôs lightweight and works well. I use it for testing stuff on my Mac. But where‚Äôs the fun in Installing docker and calling it a day?. I‚Äôm not looking to do <a href=https://github.com/kelseyhightower/kubernetes-the-hard-way target=_blank rel="noopener noreferrer">Kubernetes the hard way</a> but I want some resistance. For this reason, I would not be picking KinD.</p><h3 id=but-what-about-k3shttpsk3sio><a href=https://k3s.io/ target=_blank rel="noopener noreferrer">But what about K3s?</a></h3><p>K3s has a reputation for being lightweight and super fast. Promising a 30sec startup time along with being optimized for ARM. It is a very logical choice for my use case.</p><p>But here‚Äôs the thing. I don‚Äôt always like being ‚Äúlogical‚Äù and something about the next distribution screams INSTALL to me.</p><h3 id=i-give-you-k0s->I give you K0s !!!</h3><p><img src=https://file.coffee/u/Dft7Bepe4nxKGBKG-M_xQ.png alt=Untitled></p><p>K0s advertises itself as a ‚Äú<strong>The Zero Friction Kubernetes‚Äù,</strong> obviously this is not what I am here for, I could sit here and re-word every feature on the k0s homepage but I don‚Äôt have time for that today, However, there are a few features I really like.</p><ol><li>In-Cluster SQLite: this is the default for single-node clusters, this is probably not as performant as ETCD but I‚Äôm not trying to <a href=https://github.com/rancher/docs/issues/3134 target=_blank rel="noopener noreferrer">destroy my SD</a> (prematurely).</li><li>Horizontal Pod Autoscaling: In case I need to scale my home network to handle traffic from a thousand users ü§£.</li></ol><p>The features I mentioned most likely exist on k3s but like I said something in me really wants to give k0s a shot.</p><p>After combing the docs for several <del>days</del> hours I finally realize why the controller has refused to start. I was doing two things wrong:</p><ul><li>I was using the installation instructions for Debian machines and k0s had <a href=https://docs.k0sproject.io/v1.24.3+k0s.0/raspberry-pi4/ target=_blank rel="noopener noreferrer">instructions</a> for the raspberry pi all along ü§¶üèΩ.</li><li>Needed to enable <code>cgroups</code> on the pi and a few other <a href=https://docs.k0sproject.io/v1.24.3+k0s.0/raspberry-pi4/#set-up-nodes target=_blank rel="noopener noreferrer">options</a> and reboot the PI.</li></ul><p>Well that worked so I should have a working cluster right ?</p><p><img src=https://file.coffee/u/hgDvJrZlYZJVFCH2zth04.jpg alt=sddefault.jpg></p><p>After running <code>k0s start</code> I decide to watch the journalctl logs , which doesn‚Äôt sound like a bad idea at first , however I was met with some horrible node errors and at some point <a href=https://coredns.io target=_blank rel="noopener noreferrer">coreDNS</a> refused to start. A solid 10 minutes go by and the node errors seemed to have resolved itself and coreDNS seemed to have initialized , but I still see some ‚Äúpartial failures‚Äù in the logs and I decide to wait it out a little longer.</p><p><img src=https://file.coffee/u/8F-dh7uQ-oTdOfzk9ovsp.png alt="journalctl logs "></p><p>journalctl logs</p><p>Eventually I take the leap of faith and run <code>kubectl get nodes</code> ‚Ä¶.</p><p><img src=https://file.coffee/u/PjjdAv6xpK_hbTqQnn8uu.png alt=Untitled></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME      STATUS   ROLES           AGE    VERSION
</span></span><span style=display:flex><span>thev01d   Ready    control-plane   23m   v1.23.6+k0s
</span></span></code></pre></div><p>The node is finally ready , well Mission accomplished right ? Not quite I still need a load balancer that I can use to expose my applications, I‚Äôve heard good things about MetalLB so I would be trying that first. Thankfully k0s has a <a href=https://docs.k0sproject.io/v1.23.6+k0s.2/examples/metallb-loadbalancer/ target=_blank rel="noopener noreferrer">dedicated pag</a>e for MetalLB.</p><h2 id=what-about-nginx-ingress-controller->What about Nginx Ingress controller ?</h2><p>Ever since I learned about ingress controllers I have always stuck with Nginx because it simple and gives me the least headaches(staring at you traefik) plus A/B testing is super easy with Nginx. The problem here is I don‚Äôt really need the routing capabilities of Nginx ingress , here all I need is a single static IP I can access my services on and MetalLB seems to do that.</p><h2 id=reality-strikes>Reality strikes</h2><p><img src=https://file.coffee/u/Og352mDPI2qTK6eyFinVp.jpg alt=6qj1by.jpg></p><p>Sadly this turned out to be the case and for whatever reason my pods where not getting an external IP. Tried a googling but I am honestly not ready to battle with my crappy router and get this thing working. So I did the sane thing a defaulted to Nginx which worked flawlessly.</p><p><img src=https://file.coffee/u/itriWVFHPt0MVliz2C6il.png alt=Untitled></p><p>Ah yes sweet sweet 404 , but this wouldn‚Äôt be complete without a ‚Äúsimple https server‚Äù would it?</p><p><img src=https://file.coffee/u/ue1a6TuQq12PF-GkkIdVL.png alt=Untitled></p><h2 id=conclusion>Conclusion</h2><p>Overall this was a great learning experience , I got to learn about different Kubernetes components and how they interact with one another. Also ran into an issue where my PI refused to connect to my router because the power supply was not enough, this got me thinking about what goes on in the average datacenter and how routers can fail ( mine did) and host of other problems that the modern day cloud abstracts from users.</p><p>If you made it this far thanks for reading , I hope to blog more about hardware and other PI projects is decide to make in the near future , until then goodbye and keep chewing!</p></article><section class="article labels"><a class=tag href=/tags/kubernetes/>kubernetes</a><a class=tag href=/tags/arm/>ARM</a><a class=tag href=/tags/raspberry-pi/>Raspberry PI</a></section><section class="article author"><img class=avatar src="https://avatars.githubusercontent.com/u/53065463?v=4" alt><p class=name>s1ntaxe770r</p><div class=details><a class=item href=https://github.com/s1ntaxe770r target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;s1ntaxe770r</a><a class=item href=https://hub.docker.com/u/e770r target=_blank rel="noopener noreferrer"><span class="iconfont icon-docker"></span>&nbsp;e770r</a><a class=item href=https://twitter.com/s1ntaxe770r target=_blank rel="noopener noreferrer"><span class="iconfont icon-twitter"></span>&nbsp;@s1ntaxe770r</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/in-search-of-coherence/><span class="iconfont icon-article"></span>In Search of Coherence</a></p><p><a class=link href=/posts/2pc/><span class="iconfont icon-article"></span>Two phase commit ?</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>¬©2021 s1ntaxe770r</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a></p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-D6NJ1ZKSX9"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D6NJ1ZKSX9")}</script></body></html>