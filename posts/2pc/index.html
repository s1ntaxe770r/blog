<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.135.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Two phase commit ?&nbsp;&ndash;&nbsp;$> cat /var/log/e770r</title><link rel=stylesheet href=/css/core.min.63f706677e61b4ee62b8daf083358d3bbf8ac8ab03c7d171af3180fab3a3ebb83efb79fb98674f13dde6db11de2bf694.css integrity=sha384-Y/cGZ35htO5iuNrwgzWNO7+KyKsDx9FxrzGA+rOj67g++3n7mGdPE93m2xHeK/aU><meta name=twitter:card content="summary">
<meta name=twitter:title content="Two phase commit ?"><meta name=twitter:image content="https://file.coffee/u/wgn6g2zf9ogpds.png"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src="https://avatars.githubusercontent.com/u/53065463?v=4" alt><span class="site name">$> cat /var/log/e770r</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>Categories</a><a class="nav item" href=/tags/>Tags</a></nav></div></span></div><div class="site slogan"><span class=title>logging my experiences one blog at a time ~</span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Two phase commit ?</h1><p class="article date">2022-03-26</p></section><article class="article markdown-body"><p><img class=cover src=https://file.coffee/u/Wgn6g2ZF9OgpdS.png alt></p><h2 id=two-phase-commit>Two phase commit?</h2><p>Lately I have found myself pondering how distributed systems handle transactions, particularly what happens if one database replica is out of sync, how should the &ldquo;ideal&rdquo; distributed system handle such?</p><p>Turns out there are few ways of handling distributed transactions, and two phase commit or 2PC is one of them. So I am doing the logical thing and writing down what I have managed to learn at 2:32am on a weekday.</p><h2 id=2pc-you-say-->2PC you say ?!</h2><p><img src=https://file.coffee/u/U4Ik7C5uGiHTBK.jpg alt=wutt></p><p>First I think it&rsquo;s important to discuss what problem 2PC is trying to address before diving into how it solves it.</p><h2 id=the-problem>The problem</h2><p>When updating data across multiple nodes a prominent problem is nodes going out of sync or becoming inconsistent , so how do we ensure all nodes receive the same copy of data when update is performed?</p><h2 id=solution>Solution</h2><p>As the name suggests, two phase commit performs an update in two phases:</p><ul><li>Prepare phase</li><li>Commit phase</li></ul><h4 id=prepare-phase>Prepare phase</h4><p>In this phase all participating nodes are asked if they are able to carry out the commit by the transaction coordinator, the transaction co-ordinator is responsible for ensuring all nodes are able to perform the commit , if one node is unable is unable to carry out the commit the transaction is rolled back and marked as unsuccessful.</p><h4 id=commit-phase>Commit phase</h4><p>The second phase begins once all participating nodes are able to perform the commit. Once the commit is performed each node sends a message to the transaction co-ordinator letting it know that operation has been completed, once all participating nodes respond with a success message the transaction is marked as complete and the commit phase ends.</p><h3 id=closing-thoughts>Closing thoughts</h3><p>Obviously this was a high level overview of what 2pc is and I do not go into specifics of how 2pc works, but I think thats ok. At the beginning of this post I had no clue what two phase commit was, I&rsquo;d say this is a decent explanation for anyone who isn&rsquo;t concerned with the fine details and just wants to answer the burning question WTF is 2pc.</p><p>But if you&rsquo;d like to know more here are some relevant links I found while researching this:</p><p>From Martin Fowler
<a href=https://martinfowler.com/articles/patterns-of-distributed-systems/two-phase-commit.html#solution target=_blank rel="noopener noreferrer">https://martinfowler.com/articles/patterns-of-distributed-systems/two-phase-commit.html#solution</a></p><p>Obligatory wikipedia reference
<a href=https://en.wikipedia.org/wiki/Two-phase_commit_protocol target=_blank rel="noopener noreferrer">https://en.wikipedia.org/wiki/Two-phase_commit_protocol</a></p><p>This blog I found
<a href=https://www.techopedia.com/definition/1252/two-phase-commit target=_blank rel="noopener noreferrer">https://www.techopedia.com/definition/1252/two-phase-commit</a></p><p>Not as comprehensive but helpful
<a href=https://www.educative.io/edpresso/what-is-the-two-phase-commit-protocol target=_blank rel="noopener noreferrer">https://www.educative.io/edpresso/what-is-the-two-phase-commit-protocol</a></p></article><section class="article author"><img class=avatar src="https://avatars.githubusercontent.com/u/53065463?v=4" alt><p class=name>s1ntaxe770r</p><div class=details><a class=item href=https://github.com/s1ntaxe770r target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;s1ntaxe770r</a><a class=item href=https://hub.docker.com/u/e770r target=_blank rel="noopener noreferrer"><span class="iconfont icon-docker"></span>&nbsp;e770r</a><a class=item href=https://twitter.com/s1ntaxe770r target=_blank rel="noopener noreferrer"><span class="iconfont icon-twitter"></span>&nbsp;@s1ntaxe770r</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/kubernetes-on-arm/><span class="iconfont icon-article"></span>Kubernetes on ARM</a></p><p><a class=link href=/posts/tls-in-a-nutshell/><span class="iconfont icon-article"></span>TLS in a Nutshell</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>Â©2021 s1ntaxe770r</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a></p></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-D6NJ1ZKSX9"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D6NJ1ZKSX9")}</script></body></html>